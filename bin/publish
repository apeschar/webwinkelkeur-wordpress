#!/bin/bash

set -euo pipefail

projects=( webwinkelkeur evalor )

cd "$(dirname "$0")/.."

root="$PWD"

tmp="$(mktemp -d)"
trap "cd /; rm -rf '$tmp'" EXIT

./bin/package

for project in "${projects[@]}"; do
    if [[ $# -eq 1 ]] && [[ $1 != $project ]]; then
        continue
    fi

    cd "$tmp"

    rm -rf   package svn
    mkdir -p package svn

    svn co "http://plugins.svn.wordpress.org/$project" svn
    cd svn
    svn rm --force trunk
    mkdir trunk

    cd $tmp/package
    unzip -q $root/dist/wordpress-$project.zip
    mv $project/* $tmp/svn/trunk

    cd $tmp/svn
    svn add --force trunk
    svn ci -m 'Update plugin' --username apeschar --no-auth-cache
done
